<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <style>
        body { background: #050505; color: #fff; font-family: sans-serif; margin: 0; display: flex; }
        .sidebar { width: 250px; background: #0a0a0a; border-right: 1px solid #222; height: 100vh; padding: 20px; }
        .content { flex: 1; padding: 30px; }
        
        .card { background: #111; border: 1px solid #333; border-radius: 10px; overflow: hidden; margin-bottom: 20px; width: 300px; display: inline-block; margin-right: 20px; vertical-align: top; }
        .card img { width: 100%; height: 150px; object-fit: cover; }
        .card-body { padding: 15px; }
        
        .btn { display: block; width: 100%; padding: 10px; margin-top: 10px; border: none; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .btn-green { background: #238636; color: white; }
        .btn-help { background: transparent; border: 1px solid #555; color: #aaa; }
        
        /* POPUP */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; z-index: 100; }
        .modal-content { background: #161b22; padding: 20px; border-radius: 10px; width: 400px; max-height: 80vh; overflow-y: auto; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h3>üëã {{ user.name }}</h3>
        <p>@{{ user.username }}</p>
        <hr style="border-color: #333;">
        <p>üöÄ Dashboard</p>
        <p>üì¶ My Bots</p>
        <a href="/logout" style="color: red;">Logout</a>
    </div>

    <div class="content">
        <h1>Available Services</h1>
        
        {% for service in services %}
        <div class="card">
            <img src="{{ service.thumbnail }}">
            <div class="card-body">
                <h3>{{ service.name }}</h3>
                <p style="color: #888; font-size: 13px;">{{ service.desc }}</p>
                
                <a href="/prepare" class="btn btn-green" style="text-decoration: none; text-align: center;">‚ö° Get Started</a>
                
                <button onclick='openHelp({{ service.tutorial | tojson }})' class="btn btn-help">‚ùì Need Help</button>
            </div>
        </div>
        {% endfor %}

        <h1>üì¶ My Active Bots</h1>
        {% for bot in my_bots %}
            <div style="background: #111; padding: 10px; border: 1px solid #333; margin-bottom: 5px; display: flex; justify-content: space-between;">
                <span>{{ bot.name }}</span>
                <a href="{{ bot.app_url }}" target="_blank" style="color: #58a6ff;">Open Bot</a>
            </div>
        {% endfor %}
    </div>

    <div id="helpModal" class="modal">
        <div class="modal-content">
            <h2 style="color: #238636;">üìù Setup Steps</h2>
            <div id="stepsContainer"></div>
            <button onclick="document.getElementById('helpModal').style.display='none'" class="btn btn-help">Close</button>
        </div>
    </div>

    <script>
        function openHelp(steps) {
            const container = document.getElementById('stepsContainer');
            container.innerHTML = "";
            if(!steps || steps.length === 0) {
                container.innerHTML = "<p>No tutorial added.</p>";
            } else {
                steps.forEach((step, i) => {
                    container.innerHTML += `<p><b>Step ${i+1}:</b> ${step.text}</p>`;
                    if(step.img) container.innerHTML += `<img src="${step.img}" style="width:100%; border-radius:5px; margin-bottom:15px;">`;
                });
            }
            document.getElementById('helpModal').style.display = 'flex';
        }
    </script>
</body>
</html>
